using System;
using System.Collections.Generic;
using System.Globalization;
using BT.Editor.Internal;
using BT.Editor.RuntimeJson;
using BT.EditorIntegration;
using BT.RuntimeSerialization;
using Unity.GraphToolkit.Editor;
using UnityEngine;

namespace BT.Editor.Generated.Nodes
{
    // Auto-generated by BTCodegen.cs. Do not edit by hand.
    [Serializable]
    [UseWithGraph(typeof(BTTreeGraph))]
    class BTParallel : Node, IBTRuntimeJsonNode
    {
        const string ParentPortId = "Parent";
        const string ChildPortId = "Child";

        [SerializeField] string nodeId;
        [SerializeField] global::BT.ParallelType type;
        [SerializeField] global::BT.ParallelType ParallelType;

        public string NodeId => nodeId;
        public string RuntimeTypeId => "BT.BTParallel";
        public BTEditorNodeKind Kind => BTEditorNodeKind.Composite;
        public BTChildCapacity ChildCapacity => BTChildCapacity.Multi;

        public override void OnEnable()
        {
            if (string.IsNullOrEmpty(nodeId)) nodeId = Guid.NewGuid().ToString("N");
        }

        protected override void OnDefineOptions(IOptionDefinitionContext context)
        {
            context.AddOption<global::BT.ParallelType>("type")
                .WithDisplayName("type")
                .WithDefaultValue(type);
            context.AddOption<global::BT.ParallelType>("ParallelType")
                .WithDisplayName("ParallelType")
                .WithDefaultValue(ParallelType);
        }

        protected override void OnDefinePorts(IPortDefinitionContext context)
        {
            context.AddInputPort(ParentPortId).WithDisplayName("Parent").Build();

            if (ChildCapacity == BTChildCapacity.Single)
            {
                var output = context.AddOutputPort(ChildPortId).WithDisplayName("Child").Build();
                GraphToolkitPortCapacityUtil.TryForceSingleCapacity(output);
                return;
            }

            if (ChildCapacity == BTChildCapacity.Multi)
            {
                context.AddOutputPort("Children").WithDisplayName("Children").Build();
            }
        }

        public List<BTArgJson> CollectArgs()
        {
            var opt_type = GetNodeOptionByName("type");
            if (opt_type != null && opt_type.TryGetValue<global::BT.ParallelType>(out var v_type)) type = v_type;
            var opt_ParallelType = GetNodeOptionByName("ParallelType");
            if (opt_ParallelType != null && opt_ParallelType.TryGetValue<global::BT.ParallelType>(out var v_ParallelType)) ParallelType = v_ParallelType;

            return new List<BTArgJson>
            {
                new BTArgJson { name = "type", type = BTArgType.Int, value = ((int)type).ToString(CultureInfo.InvariantCulture) },
                new BTArgJson { name = "ParallelType", type = BTArgType.Int, value = ((int)ParallelType).ToString(CultureInfo.InvariantCulture) },
            };
        }
    }
}
